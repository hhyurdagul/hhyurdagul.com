
# To learn about configuring soupault, visit https://www.soupault.app/reference-manual

[settings]
  # Soupault version that the config was written/generated for
  # Trying to process this config with an older version will result in an error message
  soupault_version = "5.2.0"

  # Display progress?
  verbose = true

  # Display detailed debug output?
  debug = false

  # Where input files (pages and assets) are stored.
  site_dir = "site"

  # Where the output goes
  build_dir = "build"

  # Files inside the site/ directory can be treated as pages or static assets,
  # depending on the extension.
  #
  # Files with extensions from this list are considered pages and processed.
  # All other files are copied to build/ unchanged.
  #
  # Note that for formats other than HTML, you need to specify an external program
  # for converting them to HTML (see below).
  page_file_extensions = ["htm", "html", "rst", "adoc"]

  # Use soupault's built-in Markdown parser for these extensions
  markdown_extensions = ["md"]

  # By default, soupault uses "clean URLs",
  # that is, $site_dir/page.html is converted to $build_dir/page/index.html
  # You can make it produce $build_dir/page.tml instead by changing this option to false
  clean_urls = true

  # If you set clean_urls=false,
  # file names with ".html" and ".htm" extensions are left unchanged.
  keep_extensions = ["html", "htm"]

  # All other extensions (".md", ".rst"...) are replaced, by default with ".html"
  default_extension = "html"

  # Page files with these extensions are ignored.
  ignore_extensions = ["draft"]

  # Soupault can work as a website generator or an HTML processor.
  #
  # In the "website generator" mode, it considers files in site/ page bodies
  # and inserts them into the empty page template stored in templates/main.html
  #
  # Setting this option to false switches it to the "HTML processor" mode
  # when it considers every file in site/ a complete page and only runs it through widgets/plugins.
  generator_mode = true

  # Files that contain an <html> element are considered complete pages rather than page bodies,
  # even in the "website generator" mode.
  # This allows you to use a unique layout for some pages and still have them processed by widgets.
  complete_page_selector = "html"

  # Website generator mode requires a page template (an empty page to insert a page body into).
  # If you use "generator_mode = false", this file is not required.
  default_template_file = "templates/main.html"

  # Page content is inserted into a certain element of the page template.
  # This option is a CSS selector that is used for locating that element.
  # By default the content is inserted into the <body>
  # For this site, we insert page bodies into <main id="content"> in templates/main.html
  default_content_selector = "main#content"

  # Replace existing content in <main id="content"> with page body
  default_content_action = "replace_content"

  # If a page already has a document type declaration, keep the declaration
  keep_doctype = true

  # If a page does not have a document type declaration, force it to HTML5
  # With keep_doctype=false, soupault will replace existing declarations with it too
  doctype = "<!DOCTYPE html>"

  # Insert whitespace into HTML for better readability
  # When set to false, the original whitespace (if any) will be preserved as is
  pretty_print_html = true

  # Plugins can be either automatically discovered or loaded explicitly.
  # By default discovery is enabled and the place where soupault is looking is the plugins/ subdirectory
  # in your project.
  # E.g., a file at plugins/my-plugin.lua will be registered as a widget named "my-plugin".
  plugin_discovery = true
  plugin_dirs = ["plugins"]

  # Soupault can cache outputs of external programs
  # (page preprocessors and preprocess_element widget commands).
  # It's disabled by default but you can enable it and configure the cache directory name/path
  caching = false
  cache_dir = ".soupault-cache"

  # Soupault supports a variety of page source character encodings,
  # the default encoding is UTF-8
  page_character_encoding = "utf-8"
 

# Markdown is processed with soupault's built-in parser (see settings.markdown_extensions)
# If you ever want external preprocessors, you can add a [preprocessors] table here.

# Metadata extraction fields for auto-generated indexes (/writing, /projects)
[templates.writing-post]
  file = "templates/writing-post.html"
  section = "writing/"
  exclude_page = "writing/index.html"

[index]
  leaf_file = ".leaf"
  extract_after_widgets = ["insert-reading-time"]

[index.fields]
  title = { selector = ["main#content h1", "h1", "page-title"] }

[index.fields.date]
  selector = ["time.post-date", "time"]
  extract_attribute = "datetime"
  fallback_to_content = true
  strip_tags = true

[index.fields.date_display]
  selector = ["time.post-date", "time"]
  strip_tags = true

[index.fields.excerpt]
  # selector = ["main#content p.intro-text", "main#content p"]
  selector = "data#excerpt"
  strip_tags = true

[index.fields.showcase]
  selector = "data#showcase"
  extract_attribute = "value"
  fallback_to_content = false
  strip_tags = true

[index.fields.reading_time]
  selector = "data#reading-time"
  extract_attribute = "value"
  fallback_to_content = false
  strip_tags = true

[index.fields.tags]
  selector = "data#tags"
  extract_attribute = "value"
  fallback_to_content = false
  strip_tags = true

[hooks.post-index]
  lua_source = '''
     -- Split tags strings like "foo, bar" into lists
     -- to make life easier for the Atom plugin and the indexer
    if Value.is_string(index_fields["tags"]) then
      tags = Regex.split(index_fields["tags"], ",")
      Table.apply_to_values(String.trim, tags)
      index_fields["tags"] = tags
    end
'''

# Index views render lists into index pages (pages named index.*)
[index.views.writing]
  index_selector = "#writing-index"
  section = "writing/"
  include_subsections = true
  exclude_page = "writing/index.html"
  sort_by = "date"
  sort_type = "calendar"
  sort_descending = true
  index_template = """
    {% for e in entries %}
    <a href="{{e.url}}">
      <article class="blog-post">
        <div class="blog-meta">
          <span>{{e.date_display}}</span>
          <div class="dot"></div>
          <span class="reading-time">{{e.reading_time}}</span>
        </div>
        <h3>{{e.title}}</h3>
        {% if e.excerpt %}<p>{{e.excerpt}}</p>{% endif %}
        <div class="read-more">Read Log
          <svg><use href="#icon-arrow-right"></use></svg>
        </div>
      </article>
    </a>
    {% endfor %}
  """

[index.views.projects]
  page = "projects/index.html"
  index_selector = "#projects-index"
  section = "projects/"
  include_subsections = true
  exclude_page = "projects/index.html"
  sort_by = "title"
  sort_type = "lexicographic"
  sort_descending = false
  index_template = """
    {% for e in entries %}
    <div class="project-card">
      <div class="project-header">
        <h3>{{e.title}}</h3>
        <a href="{{e.url}}">
          <svg><use href="#icon-arrow-right"></use></svg>
        </a>
      </div>
      {% if e.excerpt %}<p>{{e.excerpt}}</p>{% endif %}

      <div class="tech-tags">
        {% for tag in e.tags %}
        <span>{{tag}}</span>
        {% endfor %}
      </div>
    </div>
    {% endfor %}
  """

# Homepage: show up to 3 items
[index.views.home-writing]
  page = "index.html"
  index_selector = "#home-writing-index"
  section = "writing/"
  include_subsections = true
  exclude_page = "writing/index.html"
  sort_by = "date"
  sort_type = "calendar"
  sort_descending = true
  index_template = """
    {% for e in entries %}
    {% if e.showcase %}
    <a href="{{e.url}}">
      <article class="blog-post">
        <div class="blog-meta">
          <span>{{e.date_display}}</span>
          <div class="dot"></div>
          <span class="reading-time">{{e.reading_time}}</span>
        </div>
        <h3 style="font-size: 1.125rem; margin-bottom: 0.5rem;">{{e.title}}</h3>
        {% if e.excerpt %}<p style="font-size: 0.9rem;">{{e.excerpt}}</p>{% endif %}
        <div class="read-more" style="margin-top: 0.5rem;">Read Log
          <svg><use href="#icon-arrow-right"></use></svg>
        </div>
      </article>
    </a>
    {% endif %}
    {% endfor %}
  """

[index.views.home-projects]
  page = "index.html"
  index_selector = "#home-projects-index"
  section = "projects/"
  include_subsections = true
  exclude_page = "projects/index.html"
  sort_by = "title"
  sort_type = "lexicographic"
  sort_descending = false
  index_template = """
    {% for e in entries %}
    {% if e.showcase %}
    <div class="project-card" style="padding: 1.25rem;">
      <div class="project-header" style="margin-bottom: 0.5rem;">
        <h3 style="font-size: 1.125rem;">{{e.title}}</h3>
        <a href="{{e.url}}">
          <svg><use href="#icon-arrow-right"></use></svg>
        </a>
      </div>
      {% if e.excerpt %}<p style="font-size: 0.875rem; margin-bottom: 1rem;">{{e.excerpt}}</p>{% endif %}
      <div class="tech-tags">
        {% for tag in e.tags %}
        <span>{{tag}}</span>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    {% endfor %}
  """

# Pages can be further processed with "widgets"

[hooks.post-build]
  site_url = "https://hhyurdagul.com"
  file = "plugins/hook-post-build.lua"

[widgets.insert-header]
  widget = "include"

  selector = "main"
  action = "insert_before"
  file = "templates/header.html"

[widgets.insert-footer]
  widget = "include"

  selector = "main"
  action = "insert_after"
  file = "templates/footer.html"

[widgets.insert-svg]
  widget = "include"

  selector = "body"
  action = "prepend_child"
  file = "templates/svg.html"

[widgets.delete-metadata]
  widget = "delete_element"
  selector = "post-metadata"

# Render TeX math server-side with KaTeX CLI
# Usage in Markdown/HTML:
#   Inline:  <span class="inline-math">a+b=20</span>
#   Display: <div class="display-math">\\int_0^\\infty x^2 dx</div>
[widgets.inline-math]
  widget = "preprocess_element"
  selector = ".inline-math"
  command = "katex --no-throw-on-error"
  action = "replace_content"

[widgets.display-math]
  widget = "preprocess_element"
  selector = ".display-math"
  command = "katex --display-mode --no-throw-on-error"
  action = "replace_content"

# Syntax highlighting using the `highlight` CLI (server-side)
# Works great with Markdown code fences that produce:
#   <pre><code class="language-python">...</code></pre>
[widgets.highlight]
  widget = "preprocess_element"
  selector = "pre > code[class*='language-']"
  command = "highlight -O html -f --syntax=$(echo \"$ATTR_CLASS\" | sed -e 's/.*language-//' -e 's/ .*//')"
  action = "replace_content"

# Inject highlight CSS only on pages that need it
# Implemented as a Lua plugin in plugins/highlight-assets.lua
[widgets.highlight-assets]
  after = ["highlight"]
  widget = "highlight-assets"
  css_href = "/assets/highlight/highlight.css"

# Inject KaTeX CSS only on pages that need it
# Implemented as a Lua plugin in plugins/katex-assets.lua
[widgets.katex-assets]
  after = ["inline-math", "display-math"]
  widget = "katex-assets"
  css_href = "/assets/katex/katex.min.css"

# SEO metadata (title/description/canonical/OpenGraph/Twitter)
# Implemented as a Lua plugin in plugins/seo-meta.lua
[widgets.seo-meta]
  after = ["highlight-assets", "katex-assets"]
  widget = "seo-meta"
  site_url = "https://hhyurdagul.com"
  site_name = "Hasan H端seyin Yurdag端l"
  title_suffix = " | Hasan H端seyin Yurdag端l"
  # Used for OpenGraph/Twitter previews
  og_image = "/assets/og.png"

# Add prose typography styling to article-like pages
[widgets.prose-writing]
  widget = "add-class"
  selector = "body"
  class = "article-content"
  section = "writing/"
  include_subsections = true
  exclude_page = "writing/index.html"

[widgets.prose-projects]
  widget = "add-class"
  selector = "body"
  class = "prose"
  section = "projects/"
  include_subsections = true
  exclude_page = "projects/index.html"

# Insert reading time for each post
# Implemented as a Lua plugin in plugins/reading-time.lua
[widgets.insert-reading-time]
  widget = "reading-time"
  selector = "body"
  content_selector = "main#content"
  reading_speed = 180
  section = "writing/"
  include_subsections = true
  exclude_page = "writing/index.html"

# Highlights the current section in the top navigation
# Implemented as a Lua plugin in plugins/nav-active.lua
[widgets.nav-active]
  widget = "nav-active"
  after = ["insert-header"]

# <blink> elements are evil, delete them all
[widgets.no-blink]
  widget = "delete_element"
  selector = "blink"

  # By default this widget deletes all elements matching the selector,
  # but you can set this option to false to delete just the first one
  delete_all = true
